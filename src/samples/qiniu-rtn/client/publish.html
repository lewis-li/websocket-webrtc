<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Publish Stream</title>
</head>

<body>
    <p>Local Stream</p>

    <div id="localstream"></div>

    <button onclick="joinRoom()">join Room</button>
</body>
<script src="./js/main.js"></script>
<script>
    ROOMTOKEN_1 = 'oHEJHbZHtKO5Jwf1lQoOrKI4rQNf0Mk2QCQNnrSW:6pun4RU8eIVe9Zd1eCFMNK_rTKY=:eyJhcHBJZCI6ImVjbGJkbWd6YiIsInJvb21OYW1lIjoicm9vbTEiLCJ1c2VySWQiOiJ1c2VyMSIsImV4cGlyZUF0IjoxNTY0NTY4NzU5LCJwZXJtaXNzaW9uIjoidXNlciJ9'
    // 确认引入成功
    console.log("current version", QNRTC.version);

    // 这里采用的是 async/await 的异步方案，您也可以根据需要或者习惯替换成 Promise 的写法
    async function joinRoom() {
        // 初始化一个房间 Session 对象, 这里使用 Stream 模式
        const myRoom = new QNRTC.StreamModeSession();
        // 这里替换成刚刚生成的 RoomToken
        await myRoom.joinRoomWithToken(ROOMTOKEN_1);
        console.log("joinRoom success!");

        await publish(myRoom)


    }

    // 增加一个函数 publish，用于采集并发布自己的媒体流
    // 这里的参数 myRoom 是指刚刚加入房间时初始化的 Session 对象
    async function publish(myRoom) {
        // 调用采集模块采集本地的音频和视频数据，返回一个包含这些数据的 Stream 对象
        const localStream = await QNRTC.deviceManager.getLocalStream({
            audio: { enabled: true },
            video: { enabled: true },
        });
        // 将刚刚的 Stream 对象发布到房间中
        await myRoom.publish(localStream);
        console.log("publish success!");

        // 获取页面上的一个元素作为播放画面的父元素
        const localElement = document.getElementById("localstream");
        // 调用 Stream 对象的 play 方法在这个元素下播放媒体流，其中第二个参数代表 静音播放
        localStream.play(localElement, true);
    }

</script>

</html>